<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>【MQ】MQ概念与选用 | ChenWeiHui&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="MQ的概念​        MQ(message queue)，从字面意思上看，本质是个队列，FIFO 先入先出，只不过队列中存放的内容是message 而已，还是一种跨进程的通信机制，用于上下游传递消息。在互联网架构中，MQ 是一种非常常见的上下游“逻辑解耦+物理解耦”的消息通信服务。使用了 MQ 之后，消息发送上游只需要依赖 MQ，不用依赖其他服务。 消息队列的作用1、流量消峰​">
<meta property="og:type" content="article">
<meta property="og:title" content="【MQ】MQ概念与选用">
<meta property="og:url" content="https://gitee.com/CWH6/2023/05/07/%E3%80%90MQ%E3%80%91MQ%E6%A6%82%E8%BF%B0/index.html">
<meta property="og:site_name" content="ChenWeiHui&#39;s Blog">
<meta property="og:description" content="MQ的概念​        MQ(message queue)，从字面意思上看，本质是个队列，FIFO 先入先出，只不过队列中存放的内容是message 而已，还是一种跨进程的通信机制，用于上下游传递消息。在互联网架构中，MQ 是一种非常常见的上下游“逻辑解耦+物理解耦”的消息通信服务。使用了 MQ 之后，消息发送上游只需要依赖 MQ，不用依赖其他服务。 消息队列的作用1、流量消峰​">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506101941015.png">
<meta property="og:image" content="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506102758184.png">
<meta property="og:image" content="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506103113514.png">
<meta property="article:published_time" content="2023-05-07T00:50:18.000Z">
<meta property="article:modified_time" content="2023-05-07T01:43:29.264Z">
<meta property="article:author" content="cwh">
<meta property="article:tag" content="MQ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506101941015.png">
  
    <link rel="alternate" href="/bk/atom.xml" title="ChenWeiHui&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/bk/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/bk/" id="logo">ChenWeiHui&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/bk/">Home</a>
        
          <a class="main-nav-link" href="/bk/tags">Tags</a>
        
          <a class="main-nav-link" href="/bk/archives">Archives</a>
        
          <a class="main-nav-link" href="/bk/categories">Categories</a>
        
          <a class="main-nav-link" href="/bk/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/bk/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://gitee.com/CWH6"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-【MQ】MQ概述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/bk/2023/05/07/%E3%80%90MQ%E3%80%91MQ%E6%A6%82%E8%BF%B0/" class="article-date">
  <time datetime="2023-05-07T00:50:18.000Z" itemprop="datePublished">2023-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/bk/categories/MQ/">MQ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      【MQ】MQ概念与选用
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="MQ的概念"><a href="#MQ的概念" class="headerlink" title="MQ的概念"></a>MQ的概念</h3><p>​        MQ(message queue)，从字面意思上看，<strong>本质是个队列，FIFO 先入先出</strong>，只不过<strong>队列中存放的内容是message 而已</strong>，还是<strong>一种跨进程的通信机制，用于上下游传递消息</strong>。在互联网架构中，MQ 是一种非常常见的上下游“逻辑解耦+物理解耦”的消息通信服务。<strong>使用了 MQ 之后，消息发送上游只需要依赖 MQ，不用依赖其他服务。</strong></p>
<h3 id="消息队列的作用"><a href="#消息队列的作用" class="headerlink" title="消息队列的作用"></a>消息队列的作用</h3><h4 id="1、流量消峰"><a href="#1、流量消峰" class="headerlink" title="1、流量消峰"></a>1、流量消峰</h4><p>​        举个例子，如果订单系统最多能处理一万次订单，这个处理能力应付正常时段的下单时绰绰有余，正常时段我们下单一秒后就能返回结果。<strong>但是在高峰期，如果有两万次下单操作系统是处理不了的，只能限制订单超过一万后不允许用户下单</strong>。<strong>使用消息队列做缓冲，我们可以取消这个限制，把一秒内下的订单分散成一段时间来处理，这时有些用户可能在下单十几秒后才能收到下单成功的操作，但是比不能下单的体验要好</strong></p>
<p><img src="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506101941015.png"></p>
<h4 id="2、应用解构"><a href="#2、应用解构" class="headerlink" title="2、应用解构"></a>2、应用解构</h4><p>​        以电商应用为例，应用中有订单系统、库存系统、物流系统、支付系统。用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，<strong>任何一个子系统出了故障，都会造成下单操作异常</strong>。当转变成<strong>基于消息队列的方式后，系统间调用的问题会减少很多</strong>，比如物流系统因为发生故障，需要几分钟来修复。在这几分钟的时间里，物流系统要处理的内存被缓存在消息队列中，用户的下单操作可以正常完成。当物流系统恢复后，继续处理订单信息即可，中单用户感受不到物流系统的故障，提升系统的可用性。</p>
<p><img src="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506102758184.png"></p>
<h4 id="3、异步处理"><a href="#3、异步处理" class="headerlink" title="3、异步处理"></a>3、异步处理</h4><p>​        有些服务间调用是异步的，例如A 调用B，B 需要花费很长时间执行，但是A需要知道B 什么时候可以执行完，以前一般有两种方式，A过一段时间去调用 B 的查询 api 查询。或者A 提供一个callback api.B 执行完之后调用 api通知 A 服务。这两种方式都不是很优雅，<strong>使用消息总线，可以很方便解决这个问题A 调用 B 服务后，只需要监听 B 处理完成的消息，当B 处理完成后，会发送一条消息给 MQ，MQ 会将此消息转发给A 服务。这样 A 服务既不用循环调用 B 的查询 api，也不用提供 callback api</strong>。同样B 服务也不用做这些操作。A 服务还能及时的得到异步处理成功的消息。</p>
<p><img src="https://cwh6-bucket.oss-cn-shanghai.aliyuncs.com/bk/image-20230506103113514.png"></p>
<h3 id="MQ的分类"><a href="#MQ的分类" class="headerlink" title="MQ的分类"></a>MQ的分类</h3><h4 id="1、ActiveMC"><a href="#1、ActiveMC" class="headerlink" title="1、ActiveMC"></a>1、ActiveMC</h4><p>优点:单机吞吐量万级，时效性 ms 级，可用性高，基于主从架构实现高可用性，消息可靠性较低的概率丢失数据<br>缺点:官方社区现在对 ActiveMQ 5x <strong>维护越来越少，高吞吐量场景较少使用</strong>。</p>
<h4 id="2、Kafka"><a href="#2、Kafka" class="headerlink" title="2、Kafka"></a>2、Kafka</h4><p>大数据的杀手锏，谈到大数据领域内的消息传输，则绕不开 Kafka，这款为<strong>大数据而生</strong>的消息中间件以其百万级 TPS 的吞吐量名声大噪，迅速成为大数据领域的宠儿，在数据采集、传输、存储的过程中发挥着举足轻重的作用。目前已经被 LinkedIn，Uber,Twitter,Netflix 等大公司所采纳。</p>
<p>优点:性能卓越，单机写入TPS 约在百万条/秒，最大的优点，就是<strong>吞吐量高</strong>。时效性 ms 级可用性非常高，kafka 是分布式的，一个数据多个副本，少数机器宕机，不会丢失数据，不会导致不可用,消费者采用 Pul 方式获取消息，消息有序，通过控制能够保证所有消息被消费且仅被消费一次;有优秀的第三方Kafka Web 管理界面 Kafka-Manager; 在日志领域比较成熟，被多家公司和多个开源项目使用;功能支持功能较为简单，主要支持简单的 MQ 功能，在大数据领域的实时计算以及<strong>日志采集</strong>被大规模使用。</p>
<p>缺点: Kafka 单机超过 64 个队列/分区，Load 会发生明显的飙高现象，队列越多，load 越高，发送消息响应时间变长，使用短轮询方式，实时性取决于轮询间隔时间，消费失败不支持重试，支持消息顺序，但是一台代理宕机后，就会产生消息乱序，<strong>社区更新较慢</strong>;</p>
<h4 id="3、RocketMQ"><a href="#3、RocketMQ" class="headerlink" title="3、RocketMQ"></a>3、RocketMQ</h4><p>​        RocketMQ出自阿里巴巴的开源产品，用Java 语言实现，在设计时参考了 Kafka，并做出了自己的-些改进。被阿里巴巴广泛应用在订单，交易，充值，流计算，消息推送，日志流式处理，binglog 分发等场</p>
<p>​        优点: <strong>单机吞吐量十万级</strong>,可用性非常高，分布式架构, <strong>消息可以做到 0 丢失</strong>,MQ功能较为完善，还是分布式的扩展性好,<strong>支持 10 亿级别的消息堆积</strong>，会因为堆积导致性能下降,源码是 java 我们可以自己阅读源码定制自己公司的 MQ</p>
<p>​        缺点: <strong>支持的客户端语言不多</strong>，目前是java 及 c++，其中c++不成熟，社区活跃度一般,没有在 MQ核心中去实现JMS 等接口,有些系统要迁移需要修改大量代码</p>
<h4 id="4、-RabbitMQ"><a href="#4、-RabbitMQ" class="headerlink" title="4、 RabbitMQ"></a>4、 RabbitMQ</h4><p>​        2007 年发布，是一个在 AMQP(高级消息队列协议)基础上完成的，可复用的企业消息系统，是当前<strong>最主流的消息中间件之一</strong>。</p>
<p>​        优点:由于erlang语言的高并发特性，性能较好;<strong>吞吐量到万级</strong>，MQ 功能比较完备,健壮、稳定、易用、跨平台、支持多种语言 如: Python、Ruby、.NET、JavaJMS、C、PHP、ActionScript、XMPP、STOMP等，支持AJAX 文档齐全;开源提供的管理界面非常棒，用起来很好用,<strong>社区活跃度高;更新频率相当高</strong></p>
<p>​        缺点:商业版需要收费,学习成本较高</p>
<h3 id="MQ的选用"><a href="#MQ的选用" class="headerlink" title="MQ的选用"></a>MQ的选用</h3><h4 id="1、Kafka"><a href="#1、Kafka" class="headerlink" title="1、Kafka"></a>1、Kafka</h4><p>​        Kafka 主要特点是基于 Pull 的模式来处理消息消费，追求高吞吐量，一开始的目的就是用于<strong>日志收集和传输</strong>，适合产生<strong>大量数据</strong>的互联网服务的数据收集业务。<strong>大型公司</strong>建议可以选用，如果有日志采集功能，肯定是首选kafka了</p>
<h4 id="2、-RocketMQ"><a href="#2、-RocketMQ" class="headerlink" title="2、 RocketMQ"></a>2、 RocketMQ</h4><p>​        天生为<strong>金融互联网</strong>领域而生，对于可靠性要求很高的场景，尤其是电商里面的订单扣款，以及业务削峰，在大量交易涌入时，后端可能无法及时处理的情况。RoketMQ 在稳定性上可能更值得信赖，这些业务<strong>场景在阿里双11已经经历了多次考验</strong>，如果你的业务有上述<strong>并发场景</strong>，建议可以选择 RocketMQ。</p>
<h4 id="3、-RabbitMQ"><a href="#3、-RabbitMQ" class="headerlink" title="3、 RabbitMQ"></a>3、 RabbitMQ</h4><p>​        结合erlang语言本身的<strong>并发优势性能好时效性微秒级，社区活跃度也比较高</strong>，管理界面用起来十分方便，如果你的<strong>数据量没有那么大</strong>，<strong>中小型公司</strong>优先选择功能比较完备的 RabbitMQ。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gitee.com/CWH6/2023/05/07/%E3%80%90MQ%E3%80%91MQ%E6%A6%82%E8%BF%B0/" data-id="clhldf9g4000fgspu5bsrezve" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/bk/tags/MQ/" rel="tag">MQ</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/bk/2023/05/10/%E3%80%90k3s%E3%80%91K3sa%E5%AE%89%E8%A3%85%E4%B8%8E%E9%83%A8%E7%BD%B2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          【k3s】K3s安装与部署
        
      </div>
    </a>
  
  
    <a href="/bk/2023/05/05/%E3%80%90RabbitMQ%E3%80%91%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">【MQ】RabbitMQ</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/bk/categories/MQ/">MQ</a></li><li class="category-list-item"><a class="category-list-link" href="/bk/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/bk/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/bk/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/bk/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/bk/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/ES6/" rel="tag">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/MQ/" rel="tag">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/bk/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/bk/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/bk/tags/MQ/" style="font-size: 20px;">MQ</a> <a href="/bk/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/bk/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/bk/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/bk/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/bk/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/bk/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/bk/archives/2023/04/">April 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/bk/2023/05/10/%E3%80%90Seata%E3%80%91seata%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%9B%86%E6%88%90/">【Seata】seata的部署与集成</a>
          </li>
        
          <li>
            <a href="/bk/2023/05/10/%E3%80%90ES6%E3%80%91ES6%E8%AF%AD%E6%B3%95/">【ES6】ES6语法</a>
          </li>
        
          <li>
            <a href="/bk/2023/05/10/%E3%80%90k3s%E3%80%91K3sa%E5%AE%89%E8%A3%85%E4%B8%8E%E9%83%A8%E7%BD%B2/">【k3s】K3s安装与部署</a>
          </li>
        
          <li>
            <a href="/bk/2023/05/07/%E3%80%90MQ%E3%80%91MQ%E6%A6%82%E8%BF%B0/">【MQ】MQ概念与选用</a>
          </li>
        
          <li>
            <a href="/bk/2023/05/05/%E3%80%90RabbitMQ%E3%80%91%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">【MQ】RabbitMQ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 cwh<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/bk/" class="mobile-nav-link">Home</a>
  
    <a href="/bk/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/bk/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/bk/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/bk/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/bk/fancybox/jquery.fancybox.css">

  
<script src="/bk/fancybox/jquery.fancybox.pack.js"></script>




<script src="/bk/js/script.js"></script>




  </div>
</body>
</html>